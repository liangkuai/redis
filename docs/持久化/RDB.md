# 1. RDB

> 默认方式

快照（snapshotting）持久化（RDB）。

### 1. 持久化方式
在某个时间点，对存储在内存里的数据生成快照文件（RDB 文件）存储在硬盘上。


### 2. RDB 文件存储在哪？
- 快照数据写入 `dbfilename` 配置项指定的文件，默认文件名是 dump.rdb；
- RDB 文件存储在 `dir` 配置指定的路径下。

```bash
# 默认配置
dbfilename dump.rdb
dir ./
```

### 3. 如何创建快照（执行持久化）？

#### 3.1 命令：bgsave
fork 子进程，异步存储数据到硬盘。

#### 3.2 命令：save
同步操作，Redis 服务端在快照创建完成之前不会响应其他命令。

#### 3.3 配置项：save
配置了 `save` 策略，满足条件后会触发 `bgsave` 命令。

#### 3.4 命令：shutdown
在停止服务前，会执行一次 `save` 命令。


### 4. save 策略配置
快照持久化是 Redis 默认采用的持久化方式，在 redis.conf 配置文件中默认有以下配置：

```bash
save 900 1      # 在 900秒(15分钟) 之后，如果至少有 1 个key发生变化，Redis 就会自动触发 BGSAVE 命令创建快照。

save 300 10     # 在 300秒(5分钟) 之后，如果至少有 10 个key发生变化，Redis 就会自动触发 BGSAVE 命令创建快照。

save 60 10000   # 在 60秒(1分钟) 之后，如果至少有 10000 个key发生变化，Redis 就会自动触发 BGSAVE 命令创建快照。
```


### 5. 优点
Redis 创建快照之后，

- 可以对快照进行备份，
- 可以将快照复制到其他服务器从而创建具有相同数据的服务器副本（Redis 主从结构，主要用来提高 Redis 性能），
- 还可以将快照留在原地以便重启服务器的时候使用。


### 6. 缺点
如果在新的快照文件创建完成之前，Redis服务、系统或者硬件这三者中的任意一个崩溃了，那么 Redis 将丢失从最近一次生成的快照到现在修改的所有数据。

### 7. 改进
AOF持久化
